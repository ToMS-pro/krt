<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Cari Kereta dari A ke B</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    select, button { padding: 8px; margin-top: 10px; width: 100%; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 8px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h2>Cari Kereta: Stasiun Awal → Tujuan</h2>

  <label>Stasiun Awal:</label>
  <select id="stasiunAwal"><option value="">-- Pilih --</option></select>

  <label>Stasiun Tujuan:</label>
  <select id="stasiunTujuan"><option value="">-- Pilih --</option></select>

  <table id="hasil" style="display: none;">
    <thead>
      <tr>
        <th>Nama KA</th>
        <th>Rute</th>
        <th>Berangkat dari Awal</th>
        <th>Tiba di Tujuan</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let dataKereta = [];
    const awal = document.getElementById('stasiunAwal');
    const tujuan = document.getElementById('stasiunTujuan');
    const tbody = document.querySelector('tbody');
    const hasil = document.getElementById('hasil');

    // Ambil data.json
    fetch('data.json')
      .then(res => res.json())
      .then(data => {
        dataKereta = data;
        isiDropdownStasiun();
      });

    function isiDropdownStasiun() {
      const semua = new Set();
      dataKereta.forEach(ka => ka.rute.forEach(r => semua.add(r.stasiun)));
      const list = Array.from(semua).sort();
      list.forEach(nama => {
        awal.innerHTML += `<option value="${nama}">${nama}</option>`;
        tujuan.innerHTML += `<option value="${nama}">${nama}</option>`;
      });
    }

    tujuan.addEventListener('change', tampilkanHasil);
    awal.addEventListener('change', tampilkanHasil);

    function tampilkanHasil() {
      const dari = awal.value;
      const ke = tujuan.value;
      tbody.innerHTML = '';
      hasil.style.display = 'none';

      if (!dari || !ke || dari === ke) return;

      const cocok = dataKereta.filter(ka => {
        const stasiunList = ka.rute.map(r => r.stasiun);
        const idxAwal = stasiunList.indexOf(dari);
        const idxTujuan = stasiunList.indexOf(ke);
        return idxAwal !== -1 && idxTujuan !== -1 && idxAwal < idxTujuan;
      });

      if (cocok.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4">Tidak ditemukan KA yang sesuai.</td></tr>`;
      } else {
        cocok.forEach(ka => {
          const infoAwal = ka.rute.find(r => r.stasiun === dari);
          const infoTujuan = ka.rute.find(r => r.stasiun === ke);
          const row = `
            <tr>
              <td>${ka.nama}</td>
              <td>${ka.asal} → ${ka.tujuan}</td>
              <td>${infoAwal.ber}</td>
              <td>${infoTujuan.dat}</td>
            </tr>
          `;
          tbody.innerHTML += row;
        });
      }

      hasil.style.display = 'table';
    }
  </script>
</body>
</html>
