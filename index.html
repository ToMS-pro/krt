<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Filter Jadwal KA Parcel</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    select, table { margin-top: 10px; width: 100%; padding: 8px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    table { border-collapse: collapse; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>Filter Jadwal KA Parcel</h2>

  <label for="asalSelect">Pilih Kota Asal:</label>
  <select id="asalSelect">
    <option value="">-- Pilih Asal --</option>
  </select>

  <label for="tujuanSelect">Pilih Kota Tujuan:</label>
  <select id="tujuanSelect" disabled>
    <option value="">-- Pilih Tujuan --</option>
  </select>

  <h3 id="judulKereta"></h3>
  <table id="tabelRute" style="display: none;">
    <thead>
      <tr>
        <th>Stasiun</th>
        <th>Datang</th>
        <th>Berangkat</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let dataKereta = [];

    // Ambil data dari data.json
    fetch('data.json')
      .then(res => res.json())
      .then(data => {
        dataKereta = data;
        isiAsal();
      });

    const asalSelect = document.getElementById('asalSelect');
    const tujuanSelect = document.getElementById('tujuanSelect');
    const judul = document.getElementById('judulKereta');
    const table = document.getElementById('tabelRute');
    const tbody = table.querySelector('tbody');

    function isiAsal() {
      const asalUnik = [...new Set(dataKereta.map(ka => ka.asal))];
      asalUnik.forEach(kota => {
        const opt = document.createElement('option');
        opt.value = kota;
        opt.textContent = kota;
        asalSelect.appendChild(opt);
      });
    }

    asalSelect.addEventListener('change', function () {
      const asal = this.value;
      tujuanSelect.innerHTML = '<option value="">-- Pilih Tujuan --</option>';
      tujuanSelect.disabled = true;
      judul.textContent = "";
      tbody.innerHTML = "";
      table.style.display = "none";

      if (asal === "") return;

      const tujuanUnik = [...new Set(
        dataKereta.filter(ka => ka.asal === asal).map(ka => ka.tujuan)
      )];

      tujuanUnik.forEach(tujuan => {
        const opt = document.createElement('option');
        opt.value = tujuan;
        opt.textContent = tujuan;
        tujuanSelect.appendChild(opt);
      });

      tujuanSelect.disabled = false;
    });

    tujuanSelect.addEventListener('change', function () {
      const asal = asalSelect.value;
      const tujuan = this.value;
      const hasil = dataKereta.filter(ka => ka.asal === asal && ka.tujuan === tujuan);

      if (hasil.length === 0) {
        judul.textContent = "Tidak ada jadwal kereta untuk rute ini.";
        table.style.display = "none";
        return;
      }

      judul.textContent = `${hasil[0].nama} (${asal} â†’ ${tujuan}) - ${hasil[0].jam}`;
      tbody.innerHTML = "";
      hasil[0].rute.forEach(r => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.stasiun}</td><td>${r.dat}</td><td>${r.ber}</td>`;
        tbody.appendChild(tr);
      });
      table.style.display = "table";
    });
  </script>
</body>
</html>
