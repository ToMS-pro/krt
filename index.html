<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Filter Kereta per Stasiun</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    select { width: 100%; padding: 8px; margin-top: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  </style>
</head>
<body>
  <h2>Cari KA Berdasarkan Stasiun Awal & Tujuan</h2>

  <label>Pilih Stasiun Awal:</label>
  <select id="stasiunAwal">
    <option value="">-- Pilih Stasiun Awal --</option>
  </select>

  <label>Pilih Stasiun Tujuan:</label>
  <select id="stasiunTujuan" disabled>
    <option value="">-- Pilih Stasiun Tujuan --</option>
  </select>

  <table id="hasilTabel" style="display: none;">
    <thead>
      <tr>
        <th>KA</th>
        <th>Asal → Tujuan</th>
        <th>Jam</th>
        <th>Stasiun Awal (Dat/Ber)</th>
        <th>Stasiun Tujuan (Dat/Ber)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let dataKereta = [];

    fetch('data.json')
      .then(res => res.json())
      .then(data => {
        dataKereta = data;
        isiDropdownStasiun();
      });

    const awal = document.getElementById('stasiunAwal');
    const tujuan = document.getElementById('stasiunTujuan');
    const tabel = document.getElementById('hasilTabel');
    const tbody = tabel.querySelector('tbody');

    function isiDropdownStasiun() {
      const semuaStasiun = new Set();
      dataKereta.forEach(ka => {
        ka.rute.forEach(r => semuaStasiun.add(r.stasiun));
      });

      const list = Array.from(semuaStasiun).sort();
      list.forEach(nama => {
        const opt = document.createElement('option');
        opt.value = nama;
        opt.textContent = nama;
        awal.appendChild(opt.cloneNode(true));
        tujuan.appendChild(opt.cloneNode(true));
      });
    }

    awal.addEventListener('change', () => {
      tujuan.disabled = awal.value === "";
    });

    tujuan.addEventListener('change', () => {
      const asal = awal.value;
      const tujuanSt = tujuan.value;

      tbody.innerHTML = "";
      tabel.style.display = "none";
      if (asal === "" || tujuanSt === "") return;

      const hasil = dataKereta.filter(ka => {
        const rute = ka.rute.map(r => r.stasiun);
        const idxAwal = rute.indexOf(asal);
        const idxTujuan = rute.indexOf(tujuanSt);
        return idxAwal !== -1 && idxTujuan !== -1 && idxAwal < idxTujuan;
      });

      if (hasil.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5">Tidak ada KA yang cocok.</td></tr>`;
        tabel.style.display = "table";
        return;
      }

      hasil.forEach(ka => {
        const rAwal = ka.rute.find(r => r.stasiun === asal);
        const rTujuan = ka.rute.find(r => r.stasiun === tujuanSt);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${ka.nama}</td>
          <td>${ka.asal} → ${ka.tujuan}</td>
          <td>${ka.jam}</td>
          <td>${rAwal.dat} / ${rAwal.ber}</td>
          <td>${rTujuan.dat} / ${rTujuan.ber}</td>
        `;
        tbody.appendChild(tr);
      });

      tabel.style.display = "table";
    });
  </script>
</body>
</html>
